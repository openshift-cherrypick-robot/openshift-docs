:_content-type: PROCEDURE
[id="install-adding-aws-local-zones-subnets-list_{context}"]
= Adding AWS Local Zones subnets to an installation configuration file
// TODO: Not sure I want to use something like this at all. Committing the sketch for posterity... for now.
After you create AWS Local Zones subnets, insert their IDs into the installation configuration file that you use to deploy your cluster.

.Prerequisites

* You created subnets for AWS Local Zones as described in "Creating a subnet in AWS Local Zones".

.Procedure

. In your command line environment, define the following environment variables:
** AWS_REGION
** CLUSTER_NAME
** SUBNET_NAME
// TODO: Complete if this is to be used.

. From a command line, run the following command to extract VPC private subnet IDs from AWS:
+
[source,terminal]
----
$ mapfile -t SUBNETS < <(aws cloudformation describe-stacks \
  --region ${AWS_REGION} \
  --stack-name ${CLUSTER_NAME}-vpc \
  --query 'Stacks[0].Outputs[?OutputKey==`PrivateSubnetIds`].OutputValue' \
  --output text | tr ',' '\n')
----

. From a command line, run the following command to extract VPC public subnet IDs from AWS:
+
[source,terminal]
----
$ mapfile -t -O "${#SUBNETS[@]}" SUBNETS < <(aws cloudformation describe-stacks \
  --region ${AWS_REGION} \
  --stack-name ${CLUSTER_NAME}-vpc  \
  --query 'Stacks[0].Outputs[?OutputKey==`PublicSubnetIds`].OutputValue' \
  --output text | tr ',' '\n')
----

. Export the subnet stack IDs:
+
[source,terminal]
----
$ export SUBNET_ID=$(aws cloudformation describe-stacks \
  --region ${AWS_REGION} \
  --stack-name ${SUBNET_NAME} \
  --query 'Stacks[0].Outputs[?OutputKey==`PublicSubnetIds`].OutputValue' --output text)
----

. Append the the subnet stack IDs to the `SUBNETS` list:
+
[source,terminal]
----
$ SUBNETS+=(${SUBNET_ID})
----

. View the subnet IDs:
+
[source,terminal]
----
$ echo "    subnets:"; for SB in ${SUBNETS[*]}; do echo "    - $SB"; done
----
+
.Example output
[source,terminal]
----
    subnets:
    - subnetID-private1
    - subnetID-private2
    - subnetID-private3
    - subnetID-public1
    - subnetID-public2
    - subnetID-public3
    - subnetID-localzone-public1
----

. Insert the IDs into the `install-config.yaml` file under `platform.aws.subnets`. For example:
+
.An example installation configuration that includes Local Zones subnets
[source,yaml]
----
apiVersion: v1
baseDomain: devcluster.openshift.com
metadata:
  name: ipi-localzone
platform:
  aws:
    region: us-west-2
    subnets:
    - subnetID-private1
    - subnetID-private2
    - subnetID-private3
    - subnetID-public1
    - subnetID-public2
    - subnetID-public3
    - subnetID-localzone-public1
pullSecret: '{"auths": ...}'
sshKey: ssh-ed25519 AAAA...
----

.Verification

* Use `echo` to verify the number of subnets that you have. For example:
+
[source,terminal]
----
$ echo ${#SUBNETS[*]}
----
+
.Example output
[source,terminal]
----
7
----
+
If you choose 3 AZs to be created on the VPC stack, you should have 7 subnets on this list.