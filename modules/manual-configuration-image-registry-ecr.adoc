// Module included in the following assemblies:
//
// * integration/integrate-with-image-registries.adoc
:_mod-docs-content-type: PROCEDURE
[id="manual-configuration-image-registry-ecr_{context}"]
= Manually configuring Amazon Elastic Container Registry

You can use {product-title} to create and modify Amazon Elastic Container Registry (ECR) integrations manually. If you are deploying from Amazon ECR, integrations for the Amazon ECR registries are usually automatically generated. However, you might want to create integrations on your own to scan images outside deployments. You can also modify the parameters of an automatically-generated integration. For example, you can change the authentication method used by an automatically-generated Amazon ECR integration to use AssumeRole authentication or other authorization models.

[IMPORTANT]
====
To erase changes you made to an automatically-generated ECR integration, delete the integration, and {product-title} creates a new integration for you with the automatically-generated parameters when you deploy images from Amazon ECR.
====

.Prerequisites
* You must have an Amazon Identity and Access Management (IAM) access key ID and a secret access key. Alternatively, you can use a node-level IAM proxy such as `kiam` or `kube2iam`.
* The access key must have read access to ECR. See link:https://aws.amazon.com/premiumsupport/knowledge-center/create-access-key/[How do I create an AWS access key?] for more information.
* If you are running {product-title} in Amazon Elastic Kubernetes Service (EKS) and want to integrate with an ECR from a separate Amazon account, you must first set a repository policy statement in your ECR. Follow the instructions at link:https://docs.aws.amazon.com/AmazonECR/latest/userguide/set-repository-policy.html[Setting a repository policy statement] and for *Actions*, choose the following scopes of the Amazon ECR API operations:

** ecr:BatchCheckLayerAvailability
** ecr:BatchGetImage
** ecr:DescribeImages
** ecr:GetDownloadUrlForLayer
** ecr:ListImages

.Procedure
. In the {product-title-short} portal, go to *Platform Configuration* -> *Integrations*.
. Under the *Image Integrations* section, select *Amazon ECR*.
. Click *New integration*, or click one of the automatically-generated integrations to open it, then click *Edit*.
. Enter or modify the details for the following fields:
.. *Update stored credentials*: Clear this box if you are modifying an integration without updating the credentials such as access keys and passwords.
.. *Integration name*: The name of the integration.
.. *Registry ID*: The ID of the registry.
.. *Endpoint*: The address of the registry. This field is not enabled when the AssumeRole option is selected.
.. *Region*: The region for the registry; for example, `us-west-1`.
. If you are using IAM, select *Use Container IAM role*. Otherwise, clear the *Use Container IAM role* box and enter the *Access key ID* and *Secret access key*.
. If you are using AssumeRole authentication, select *Use AssumeRole* and enter the details for the following fields:
.. *AssumeRole ID*: The ID of the role to assume.
.. *AssumeRole External ID* (optional): If you are using an link:https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-user_externalid.html[external ID with AssumeRole], you can enter it here.
. Select *Create integration without testing* to create the integration without testing the connection to the registry.
. Select *Test* to test that the integration with the selected registry is working.
. Select *Save*.
