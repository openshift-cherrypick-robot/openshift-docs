// Module included in the following assemblies:
//
// * installing/installing_openstack/installing-openstack-installer-kuryr.adoc

[id="installation-osp-kuryr-known-limitations_{context}"]
= Known limitations of installing with Kuryr

Using {product-title} with Kuryr SDN has several known limitations.

[discrete]
[id="openstack-version-limitations_{context}"]
== {rh-openstack} version limitations

Using {product-title} with Kuryr SDN has several limitations that depend on the {rh-openstack} version.

* {rh-openstack} versions before 16 use
the default Octavia load balancer driver (Amphora). This driver requires that one
Amphora load balancer VM is deployed per OpenShift Service. Creating too many
Services can cause you to run out of resources.
+
Deployments of later versions of {rh-openstack} that have the OVN Octavia driver disabled also
use the Amphora driver. They are subject to the same resource concerns as earlier versions of {rh-openstack}.

* Octavia {rh-openstack} versions before 16 do not support UDP listeners. Therefore,
OpenShift UDP services are not supported.

* Octavia {rh-openstack} versions before 16 cannot listen to multiple protocols on the
same port. Services that expose the same port to different protocols, like TCP
and UDP, are not supported.

[IMPORTANT]
====
The OVN Octavia driver does not support listeners that use different protocols on
any {rh-openstack} version.
====

[discrete]
[id="openstack-go-limitations_{context}"]
== {rh-openstack} environment limitations

There are limitations when using Kuryr SDN that depend on your deployment environment.

Because of Octavia's lack of support for the UDP protocol and multiple listeners, Kuryr forces Pods to use TCP
for DNS resolution if:

* The {rh-openstack} version is earlier than 16
* The OVN Octavia driver is used

In Go versions 1.12 and earlier, applications that are compiled with CGO support disabled use UDP only. In this case,
the native Go resolver does not recognize the `use-vc` option in `resolv.conf`, which controls whether TCP is forced for DNS resolution.
As a result, UDP is still used for DNS resolution, which fails.

To ensure that TCP forcing is allowed, compile applications either with the environment variable `CGO_ENABLED` set to `1`, i.e. `CGO_ENABLED=1`, or ensure that the variable is absent.

In Go versions 1.13 and later, TCP is used automatically if DNS resolution using UDP fails.

[NOTE]
====
musl-based containers, including Alpine-based containers, do not support the `use-vc` option.
====

[discrete]
[id="openstack-upgrade-limitations_{context}"]
== {rh-openstack} upgrade limitations

There are limitations to consider when using Kuryr SDN during the {rh-openstack}
upgrades process, in relation to Octavia and its load balancers updates.

When OpenStack is upgraded, besides the expected Octavia's API changes, there is
a need for updating the amphora image that will be used for the load balancer
VMs. However, there is two options for the existing load balancer VMs:

* {rh-openstack} operator handles the image upgrade of the existing load balancer VMs by triggering a link:https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.0/html/networking_guide/sec-octavia#update-running-amphora-instances[Load Balancer failover] action per existing Load Balancer.
* {rh-openstack} operator does nothing related to existing load balancers VMs
and leaves the update for the users.

Both actions have implications when using Kuryr SDN:
* If the {rh-openstack} operator handles the upgrade, there may be small
downtimes during the Octavia loadbalancers failover affecting the related
Services.

* If the {rh-openstack} operator does not handle the upgrade of existing Load
Balancer VMs, new features enabled by Octavia API (e.g., UDP listeners) won't
work on the existing load balancers. Given that UDP services were not supported
in {rh-openstack} versions earlier than 16, if the {rh-openstack} operator does
not handle the load balancers upgrade, users would need to recreate their
Services if they want to expose UDP ports, instead of modifying the current
service specification to add UDP ports.

[IMPORTANT]
====
Due to the above limitations, the cluster network operator triggers the recreation
of the dns service as soon as the new Octavia version that supports UDP load
balancing is detected. This is done to ensure a new dns-default loadbalancer
is created with support for UDP loadbalancing.
This allows the removal of the admission webhook deployed for Kuryr to ensure
dns resolution was forced through TCP instead of UDP.
Note this causes downtime (around 1 minute) on the dns resolution service
while the loadbalancer is being recreated.
====

