// Module included in the following assemblies:
//
// * installing/install-quick-roxctl.adoc
// * installing/installing_ocp/install-secured-cluster-ocp.adoc
// * installing/installing_other/install-secured-cluster-other.adoc
// * cloud_service/installing_cloud_ocp/install-secured-cluster-cloud-ocp.adoc
// * cloud_service/installing_cloud_other/install-secured-cluster-cloud-other.adoc

:_mod-docs-content-type: PROCEDURE
[id="install-sensor-roxctl_{context}"]
= Installing Sensor

ifeval::["{context}" == "install-secured-cluster-cloud-other"]
:cloud-svc:
endif::[]

ifeval::["{context}" == "install-secured-cluster-cloud-other"]
:kube:
endif::[]

To monitor a cluster, you must deploy Sensor. You must deploy Sensor into each cluster that you want to monitor. This installation method is also called the manifest installation method.

To perform an installation by using the manifest installation method, follow _only one_ of the following procedures:

* Use the {product-title-short} web portal to download the cluster bundle, and then extract and run the sensor script.
* Use the `roxctl` CLI to generate the required sensor configuration for your {ocp} cluster and associate it with your Central instance.

.Prerequisites
* You must have already installed Central services, or you can access Central services by selecting your *ACS instance* on {rh-rhacscs-first}.

[id="installing-manifest-web-portal_{context}"]
== Manifest installation method by using the web portal

.Procedure

. On your secured cluster, in the {product-title-short} portal, go to *Platform Configuration* -> *Clusters*.
. Select *Secure a cluster* -> *Legacy installation method*.
. Specify a name for the cluster.
. Provide appropriate values for the fields based on where you are deploying the Sensor.
ifndef::cloud-svc[]
** If you are deploying Sensor in the same cluster, accept the default values for all the fields.
** If you are deploying into a different cluster, replace `central.stackrox.svc:443` with a load balancer, node port, or other address, including the port number, that is accessible from the other cluster.
** If you are using a non-gRPC capable load balancer, such as HAProxy, AWS Application Load Balancer (ALB), or AWS Elastic Load Balancing (ELB), use the WebSocket Secure (`wss`) protocol. To use `wss`:
*** Prefix the address with *`wss://`*.
*** Add the port number after the address, for example, `wss://stackrox-central.example.com:443`.
endif::cloud-svc[]
ifdef::cloud-svc[]
** Enter the Central API Endpoint, including the address and the port number. You can view this information again in the {cloud-console} by choosing *Advanced Cluster Security* -> *ACS Instances*, and then clicking the ACS instance you created.
endif::cloud-svc[]
. Click *Next* to continue with the Sensor setup.
. Click *Download YAML File and Keys* to download the cluster bundle (zip archive).
+
[IMPORTANT]
====
The cluster bundle zip archive includes unique configurations and keys for each cluster.
Do not reuse the same files in another cluster.
====
. From a system that has access to the monitored cluster, extract and run the `sensor` script from the cluster bundle:
+
[source,terminal]
----
$ unzip -d sensor sensor-<cluster_name>.zip
----
+
[source,terminal]
----
$ ./sensor/sensor.sh
----
If you get a warning that you do not have the required permissions to deploy Sensor, follow the on-screen instructions, or contact your cluster administrator for help.

After Sensor is deployed, it contacts Central and provides cluster information.

[id="manifest-roxctl_{context}"]
== Manifest installation by using the roxctl CLI

.Procedure

. Generate the required sensor configuration for your {ocp} cluster and associate it with your Central instance by running the following command:
+
[source,terminal,subs="+quotes"]
----
$ roxctl sensor generate openshift --openshift-version _<ocp_version>_ --name _<cluster_name>_ --central "$ROX_ENDPOINT" <1>
----
+
<1> For the `--openshift-version` option, specify the major {ocp} version number for your cluster. For example, specify `3` for {ocp} version `3.x` and specify `4` for {ocp} version `4.x`.
. From a system that has access to the monitored cluster, extract and run the `sensor` script from the cluster bundle:
+
[source,terminal]
----
$ unzip -d sensor sensor-<cluster_name>.zip
----
+
[source,terminal]
----
$ ./sensor/sensor.sh
----
If you get a warning that you do not have the required permissions to deploy Sensor, follow the on-screen instructions, or contact your cluster administrator for help.

After Sensor is deployed, it contacts Central and provides cluster information.

.Verification
. Return to the {product-title-short} portal and check if the deployment is successful.
If successful, when viewing your list of clusters in *Platform Configuration* -> *Clusters*, the cluster status displays a green checkmark and a *Healthy* status.
If you do not see a green checkmark, use the following command to check for problems:
ifndef::kube[]
* On {ocp}, enter the following command:
+
[source,terminal]
----
$ oc get pod -n stackrox -w
----
endif::[]
* On Kubernetes, enter the following command:
+
[source,terminal]
----
$ kubectl get pod -n stackrox -w
----
. Click *Finish* to close the window.

After installation, Sensor starts reporting security information to {product-title-short} and the {product-title-short} portal dashboard begins showing deployments, images, and policy violations from the cluster on which you have installed the Sensor.

ifeval::["{context}" == "install-secured-cluster-cloud-other"]
:!cloud-svc:
endif::[]

ifeval::["{context}" == "install-secured-cluster-cloud-other"]
:!kube:
endif::[]